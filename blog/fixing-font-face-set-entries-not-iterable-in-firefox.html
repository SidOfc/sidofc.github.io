<!DOCTYPE html><html lang="en" class="no-js"><head><meta charSet="utf-8"/><title>Sidney Liebrand&#x27;s blog - Handling FontFaceSet.entries() result not being iterable in Firefox</title><link rel="canonical" href="https://sidneyliebrand.io/blog/fixing-font-face-set-entries-not-iterable-in-firefox"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#a676ff"/><link rel="icon" sizes="48x48" type="image/icon" href="/favicon.ico"/><link rel="icon" sizes="16x16" type="image/png" href="/favicon-16x16.png"/><link rel="icon" sizes="32x32" type="image/png" href="/favicon-32x32.png"/><link rel="apple-touch-icon" sizes="180x180" type="image/png" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" title="The official https://sidneyliebrand.io Atom feed" href="/atom.xml"/><link rel="alternate" type="application/rss+xml" title="The official https://sidneyliebrand.io RSS feed" href="/feed.xml"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="theme-color" content="#ffffff"/><meta name="msapplication-TileColor" content="#ffc40d"/><meta name="robots" content="index, follow"/><meta name="author" content="Sidney Liebrand"/><meta name="description" content="This post describes how to deal with a bug in Firefox where it fails to properly identify the result of &lt;code&gt;FontFaceSet.entries()&lt;/code&gt; as an actual iterable object."/><meta property="og:title" content="Handling FontFaceSet.entries() result not being iterable in Firefox"/><meta property="og:type" content="website"/><meta property="og:url" content="https://sidneyliebrand.io"/><meta property="og:site_name" content="https://sidneyliebrand.io"/><meta property="og:description" content="This post describes how to deal with a bug in Firefox where it fails to properly identify the result of &lt;code&gt;FontFaceSet.entries()&lt;/code&gt; as an actual iterable object."/><meta name="dc:creator" content="Sidney Liebrand"/><meta name="dc:title" content="Handling FontFaceSet.entries() result not being iterable in Firefox"/><meta name="dc:description" content="This post describes how to deal with a bug in Firefox where it fails to properly identify the result of &lt;code&gt;FontFaceSet.entries()&lt;/code&gt; as an actual iterable object."/><meta name="twitter:card" content="summary"/><meta name="twitter:creator"/><meta name="next-head-count" content="27"/><script>window.themeBackgrounds={light:"#efefef",dark:"#111"},window.themeNames=Object.keys(themeBackgrounds),function(){var e,a=window.themeBackgrounds||{},c=Object.keys(a),t=document,n=t.querySelector("html"),o=t.createElement("style");try{e=localStorage.getItem("theme")}catch(e){}function r(e,t){if(c.forEach(function(e){n.classList.remove(e)}),e&&(n.classList.add(e),o.innerHTML="html { background-color:"+a[e]+"; }"),t)try{e?localStorage.setItem("theme",e):localStorage.removeItem("theme")}catch(e){}}e=e||"light",n.classList.remove("no-js"),t.head.appendChild(o),window.addEventListener("click",function(e){e=e.target.getAttribute("data-theme");e&&r(e,!0)}),window.addEventListener("storage",function(e){"theme"===e.key&&r(e.newValue)}),window.matchMedia&&(t=window.matchMedia("(prefers-color-scheme: dark)"),!e&&t.matches&&(e="dark"),t.addEventListener("change",function(e){try{localStorage.getItem("theme")||r(e.matches?"dark":"light")}catch(e){}})),r(e)}();</script><link rel="preload" href="/_next/static/css/94042641be5bb8ff.css" as="style"/><link rel="stylesheet" href="/_next/static/css/94042641be5bb8ff.css" data-n-g=""/><link rel="preload" href="/_next/static/css/2e1420e067a529d6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2e1420e067a529d6.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-ee7e63bc15b31913.js" defer=""></script><script src="/_next/static/chunks/framework-02398e00071ab346.js" defer=""></script><script src="/_next/static/chunks/main-b4f56f275c696d34.js" defer=""></script><script src="/_next/static/chunks/pages/_app-64d683bc8d91b300.js" defer=""></script><script src="/_next/static/chunks/982-6db0df675ccba243.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-8dab19eba9e66ab5.js" defer=""></script><script src="/_next/static/cC1Szj2xy36RxrkTbSqf5/_buildManifest.js" defer=""></script><script src="/_next/static/cC1Szj2xy36RxrkTbSqf5/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="layout_application__dwRj8"><header class="layout_header__PamGz"><div class="layout_headerFixed__9jfXi"><div class="layout_headerContent__QnbZ2"><a class="layout_logo__aPV1g" title="View home page" href="/"><span class="layout_logoTopLeft___eyDK"></span><span class="layout_logoBottomLeft__I65pR"></span><span class="layout_logoTopRight__oke9p"></span><span class="layout_logoBottomRight__eVOXL"></span></a><nav class="layout_navigation__ACKPn"><a title="View curriculum vitae" href="/cv">C.V.</a><a title="Visit Sidney Liebrand&#x27;s GitHub page" href="https://github.com/SidOfc"><figure class="layout_github__8SImE media_figure__xGL2a media_invertDark__E_DwP"><div class="media_relative__TC0n4" style="padding-bottom:100%"><img loading="lazy" class="media_media__tGftk" src="/media/github.svg" alt="Sidney Liebrand&#x27;s GitHub page"/></div></figure></a><div tabindex="0" title="Toggle dark theme" class="dark-mode-toggle_wrapper__EPTcL"><svg fill="#000000" data-theme="light" class="dark-mode-toggle_toggle__lj_e6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"></path><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"></path></svg><svg fill="#000000" data-theme="dark" class="dark-mode-toggle_toggle__lj_e6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"></path><path d="M9.5,2c-1.82,0-3.53,0.5-5,1.35c2.99,1.73,5,4.95,5,8.65s-2.01,6.92-5,8.65C5.97,21.5,7.68,22,9.5,22c5.52,0,10-4.48,10-10 S15.02,2,9.5,2z"></path></svg></div></nav></div></div></header><main class="layout_content__M_5eu"><article class="post_post__blG85"><h1 class="heading_container__rXliZ"><a class="heading_link__lpFzm" href="/blog/fixing-font-face-set-entries-not-iterable-in-firefox">Handling FontFaceSet.entries() result not being iterable in Firefox</a></h1><span class="post_postData__6yOKI text_page-accent-fg__N0I1H">By Sidney Liebrand on<!-- --> <!-- -->Nov 29, 2022<span class="bullet_bullet__k7HK1">â€¢</span>3<!-- --> min read</span><section><p>Today at work I fixed a bug while working with <code>FontFaceSet.entries()</code> which only
appears in Firefox. This might not seem so strange in browser land, until I give
you the gist of the bug. So without further ado, let&#x27;s get into it!</p>
<h2 class="heading_container__rXliZ"><a class="heading_anchor__e_uQU" id="bug-description"></a><a class="heading_link__lpFzm" href="#bug-description">Bug description</a></h2>
<p>You may at some point have used methods such as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries"><code>Object.entries()</code></a>
or <a href="https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams/entries"><code>URLSearchParams.entries()</code></a> to get an iterator of <code>[key, value]</code> arrays.
This iterator can then be used to <em>loop</em> over collections of data using
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...of"><code>for...of</code></a> loops, or can be spread into an array using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax">spread syntax</a>.</p>
<p>This concept is pretty well known and has been widely implemented across browsers
for quite some time so there should be no need to worry about implementation differences.</p>
<p>Unfortunately, this changed for me after encountering an issue <em>only</em> in Firefox
where <code>FontFaceSet.entries()</code> does not return an iterable object while
it does in fact look <strong>quite iterable</strong>:</p>
<figure class="media_figure__xGL2a"><div class="media_relative__TC0n4" style="padding-bottom:12.072892938496583%"><img loading="lazy" class="media_media__tGftk" src="/media/posts/entries-not-iterable-firefox.png" alt="FontFaceSet.entries() is not iterable error"/></div><figcaption class="media_alt__GDLBV">FontFaceSet.entries() is not iterable error</figcaption></figure>
<h2 class="heading_container__rXliZ"><a class="heading_anchor__e_uQU" id="debugging-the-problem"></a><a class="heading_link__lpFzm" href="#debugging-the-problem">Debugging the problem</a></h2>
<p>To look further into what is causing this, we must know what
<code>document.fonts.entries()</code> returns. We can figure out by creating
a minimal reproducible example which can be used for debugging.</p>
<p>Given the following HTML:</p>
<pre class="prism-code language-html"><div class="token-line"><span class="token doctype punctuation">&lt;!</span><span class="token doctype doctype-tag">DOCTYPE</span><span class="token doctype"> </span><span class="token doctype name">html</span><span class="token doctype punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag">html</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">head</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">title</span><span class="token tag punctuation">&gt;</span><span class="token plain">FontFaceSet.entries()</span><span class="token tag punctuation">&lt;/</span><span class="token tag">title</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">link</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">            </span><span class="token tag attr-name">type</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">text/css</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">            </span><span class="token tag attr-name">rel</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">stylesheet</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">            </span><span class="token tag attr-name">href</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">https://fonts.googleapis.com/css2?family=Lato:wght@400&amp;display=swap</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">        </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">link</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">            </span><span class="token tag attr-name">type</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">text/css</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">            </span><span class="token tag attr-name">rel</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">stylesheet</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">            </span><span class="token tag attr-name">href</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">https://fonts.googleapis.com/css2?family=Roboto:wght@400&amp;display=swap</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">        </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">head</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">body</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">span</span><span class="token tag"> </span><span class="token tag special-attr attr-name">style</span><span class="token tag special-attr attr-value punctuation attr-equals">=</span><span class="token tag special-attr attr-value punctuation">&quot;</span><span class="token tag special-attr attr-value value css language-css property">font-family</span><span class="token tag special-attr attr-value value css language-css punctuation">:</span><span class="token tag special-attr attr-value value css language-css"> Lato</span><span class="token tag special-attr attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain">Hello</span><span class="token tag punctuation">&lt;/</span><span class="token tag">span</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">span</span><span class="token tag"> </span><span class="token tag special-attr attr-name">style</span><span class="token tag special-attr attr-value punctuation attr-equals">=</span><span class="token tag special-attr attr-value punctuation">&quot;</span><span class="token tag special-attr attr-value value css language-css property">font-family</span><span class="token tag special-attr attr-value value css language-css punctuation">:</span><span class="token tag special-attr attr-value value css language-css"> Roboto</span><span class="token tag special-attr attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain">World</span><span class="token tag punctuation">&lt;/</span><span class="token tag">span</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag"> </span><span class="token tag attr-name">type</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">text/javascript</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">            </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation">.</span><span class="token script language-javascript method function property-access">log</span><span class="token script language-javascript punctuation">(</span><span class="token script language-javascript dom variable">document</span><span class="token script language-javascript punctuation">.</span><span class="token script language-javascript property-access">fonts</span><span class="token script language-javascript punctuation">.</span><span class="token script language-javascript method function property-access">entries</span><span class="token script language-javascript punctuation">(</span><span class="token script language-javascript punctuation">)</span><span class="token script language-javascript punctuation">)</span><span class="token script language-javascript punctuation">;</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">        </span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">body</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">html</span><span class="token tag punctuation">&gt;</span></div></pre>
<p>Opening this page in Firefox yields the following result in the console:</p>
<pre class="prism-code language-javascript"><div class="token-line"><span class="token maybe-class-name">FontFaceSetIterator</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token punctuation">}</span></div></pre>
<p>Whereas in Chrome the following result appears in the console:</p>
<pre class="prism-code language-javascript"><div class="token-line"><span class="token maybe-class-name">Iterator</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token punctuation">}</span></div></pre>
<p>Interesting indeed but alas, <strong>neither</strong> of these is actually documented
(iterator <em><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols">protocols</a></em> are, but not the objects themselves).
In one case while checking <a href="https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams/entries"><code>URLSearchParams.entries()</code></a>
documentation the word &quot;iterator&quot; even links to the &quot;iterator <em>protocols</em>&quot; page... ðŸ˜•</p>
<h2 class="heading_container__rXliZ"><a class="heading_anchor__e_uQU" id="looking-for-answers"></a><a class="heading_link__lpFzm" href="#looking-for-answers">Looking for answers</a></h2>
<p>One of the first things I did after realizing there was no documentation
was to see if a bug was open on Firefox&#x27;s bug tracker. Indeed two issues mention
this unholy Firefox construct:</p>
<ul>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1729089">https://bugzilla.mozilla.org/show_bug.cgi?id=1729089</a></li>
<li><a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1780657">https://bugzilla.mozilla.org/show_bug.cgi?id=1780657</a></li>
</ul>
<p>Unfortunately one is already a year old at the time of writing this article
which means there is little hope for a &quot;hotfix&quot; and also means that this
behavior has existed in Firefox for at least one year.</p>
<p>Since this isn&#x27;t something Firefox seems to be fixing and the documentation
is lacking there isn&#x27;t much to do aside from writing a workaround.</p>
<h2 class="heading_container__rXliZ"><a class="heading_anchor__e_uQU" id="solving-the-problem"></a><a class="heading_link__lpFzm" href="#solving-the-problem">Solving the problem</a></h2>
<p>The value returned by <code>document.fonts.entries()</code> in Firefox may not be &quot;officially&quot;
iterable from the browser&#x27;s own perspective, but it <strong>does</strong> have a <code>.next()</code>
method as is required per <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#the_iterator_protocol">iterator protocol</a>.</p>
<p>So, instead of relying on the browser we write our own function which exhausts this fake &quot;iterator&quot;:</p>
<pre class="prism-code language-javascript"><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">fontFaceSetIteratorToArray</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> iterable </span><span class="token operator">=</span><span class="token plain"> target</span><span class="token punctuation">.</span><span class="token method function property-access">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> results </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> iterator </span><span class="token operator">=</span><span class="token plain"> iterable</span><span class="token punctuation">.</span><span class="token method function property-access">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">while</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">iterator</span><span class="token punctuation">.</span><span class="token property-access">done</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        results</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token plain">iterator</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        iterator </span><span class="token operator">=</span><span class="token plain"> iterable</span><span class="token punctuation">.</span><span class="token method function property-access">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> results</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre>
<p>Which means that in Firefox we can now finally loop over font faces ðŸŽ‰</p>
<pre class="prism-code language-javascript"><div class="token-line"><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token function">fontFaceSetIteratorToArray</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">fonts</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre>
<p>This piece of code works in all modern browsers so it can be used wherever
references to <code>FontFaceSet.entries()</code> exist. It&#x27;s not pretty, but it beats
writing unreliable browser detection code.</p>
<h2 class="heading_container__rXliZ"><a class="heading_anchor__e_uQU" id="conclusion"></a><a class="heading_link__lpFzm" href="#conclusion">Conclusion</a></h2>
<p>Considering this is still an active problem in Firefox roughly a month before 2023,
using spread syntax, <code>for...of</code>, or <code>Array.from</code> on <code>FontFaceSet.entries()</code> results is
<strong>not viable</strong> and instead a polyfill such as the one found in this article must be
used instead to ensure proper functionality across browsers.</p>
<p>It&#x27;ll take some time before we can finally start using <code>[...document.fonts.entries()]</code>
considering that even after closing the issue, we&#x27;re still dependent on
everyone updating their browsers.</p>
<p>While this post does not end on a high note I do hope Firefox developers fix this
issue at some point so we can all enjoy the syntactically sugarcoated patterns
we know and love :)</p>
<p>Until next time!</p>
<p>ðŸ‘‹</p></section><a tabindex="0" class="button_button__eJwei" href="/">Back</a></article></main><footer class="layout_footer__U7ng8"><strong>Â©</strong> sidneyliebrand.io<!-- --> <!-- -->2024<span class="bullet_bullet__k7HK1 bullet_wide__C2XLP">â€¢</span><a title="View RSS feed" href="/feed.xml">RSS</a><span class="bullet_bullet__k7HK1 bullet_wide__C2XLP">â€¢</span><a title="View Atom feed" href="/atom.xml">Atom</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Handling FontFaceSet.entries() result not being iterable in Firefox","description":"This post describes how to deal with a bug in Firefox where it fails to properly identify the result of \u003ccode\u003eFontFaceSet.entries()\u003c/code\u003e as an actual iterable object.","published":"2022-11-29T19:20:00Z","readTimeInMinutes":3,"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    p: \"p\",\n    code: \"code\",\n    h2: \"h2\",\n    a: \"a\",\n    em: \"em\",\n    strong: \"strong\",\n    pre: \"pre\",\n    ul: \"ul\",\n    li: \"li\"\n  }, _provideComponents(), props.components), {Media} = _components;\n  if (!Media) _missingMdxReference(\"Media\", true);\n  return _jsxs(_Fragment, {\n    children: [_jsxs(_components.p, {\n      children: [\"Today at work I fixed a bug while working with \", _jsx(_components.code, {\n        children: \"FontFaceSet.entries()\"\n      }), \" which only\\nappears in Firefox. This might not seem so strange in browser land, until I give\\nyou the gist of the bug. So without further ado, let's get into it!\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Bug description\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"You may at some point have used methods such as \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries\",\n        children: _jsx(_components.code, {\n          children: \"Object.entries()\"\n        })\n      }), \"\\nor \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams/entries\",\n        children: _jsx(_components.code, {\n          children: \"URLSearchParams.entries()\"\n        })\n      }), \" to get an iterator of \", _jsx(_components.code, {\n        children: \"[key, value]\"\n      }), \" arrays.\\nThis iterator can then be used to \", _jsx(_components.em, {\n        children: \"loop\"\n      }), \" over collections of data using\\n\", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...of\",\n        children: _jsx(_components.code, {\n          children: \"for...of\"\n        })\n      }), \" loops, or can be spread into an array using \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax\",\n        children: \"spread syntax\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"This concept is pretty well known and has been widely implemented across browsers\\nfor quite some time so there should be no need to worry about implementation differences.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Unfortunately, this changed for me after encountering an issue \", _jsx(_components.em, {\n        children: \"only\"\n      }), \" in Firefox\\nwhere \", _jsx(_components.code, {\n        children: \"FontFaceSet.entries()\"\n      }), \" does not return an iterable object while\\nit does in fact look \", _jsx(_components.strong, {\n        children: \"quite iterable\"\n      }), \":\"]\n    }), \"\\n\", _jsx(Media, {\n      src: \"/media/posts/entries-not-iterable-firefox.png\",\n      alt: \"FontFaceSet.entries() is not iterable error\",\n      width: \"878\",\n      height: \"106\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Debugging the problem\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"To look further into what is causing this, we must know what\\n\", _jsx(_components.code, {\n        children: \"document.fonts.entries()\"\n      }), \" returns. We can figure out by creating\\na minimal reproducible example which can be used for debugging.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Given the following HTML:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-html\",\n        children: \"\u003c!DOCTYPE html\u003e\\n\u003chtml\u003e\\n    \u003chead\u003e\\n        \u003ctitle\u003eFontFaceSet.entries()\u003c/title\u003e\\n        \u003clink\\n            type=\\\"text/css\\\"\\n            rel=\\\"stylesheet\\\"\\n            href=\\\"https://fonts.googleapis.com/css2?family=Lato:wght@400\u0026display=swap\\\"\\n        /\u003e\\n        \u003clink\\n            type=\\\"text/css\\\"\\n            rel=\\\"stylesheet\\\"\\n            href=\\\"https://fonts.googleapis.com/css2?family=Roboto:wght@400\u0026display=swap\\\"\\n        /\u003e\\n    \u003c/head\u003e\\n    \u003cbody\u003e\\n        \u003cspan style=\\\"font-family: Lato\\\"\u003eHello\u003c/span\u003e\\n        \u003cspan style=\\\"font-family: Roboto\\\"\u003eWorld\u003c/span\u003e\\n        \u003cscript type=\\\"text/javascript\\\"\u003e\\n            console.log(document.fonts.entries());\\n        \u003c/script\u003e\\n    \u003c/body\u003e\\n\u003c/html\u003e\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Opening this page in Firefox yields the following result in the console:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-javascript\",\n        children: \"FontFaceSetIterator { }\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Whereas in Chrome the following result appears in the console:\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-javascript\",\n        children: \"Iterator { }\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Interesting indeed but alas, \", _jsx(_components.strong, {\n        children: \"neither\"\n      }), \" of these is actually documented\\n(iterator \", _jsx(_components.em, {\n        children: _jsx(_components.a, {\n          href: \"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols\",\n          children: \"protocols\"\n        })\n      }), \" are, but not the objects themselves).\\nIn one case while checking \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams/entries\",\n        children: _jsx(_components.code, {\n          children: \"URLSearchParams.entries()\"\n        })\n      }), \"\\ndocumentation the word \\\"iterator\\\" even links to the \\\"iterator \", _jsx(_components.em, {\n        children: \"protocols\"\n      }), \"\\\" page... ðŸ˜•\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Looking for answers\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"One of the first things I did after realizing there was no documentation\\nwas to see if a bug was open on Firefox's bug tracker. Indeed two issues mention\\nthis unholy Firefox construct:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://bugzilla.mozilla.org/show_bug.cgi?id=1729089\",\n          children: \"https://bugzilla.mozilla.org/show_bug.cgi?id=1729089\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://bugzilla.mozilla.org/show_bug.cgi?id=1780657\",\n          children: \"https://bugzilla.mozilla.org/show_bug.cgi?id=1780657\"\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Unfortunately one is already a year old at the time of writing this article\\nwhich means there is little hope for a \\\"hotfix\\\" and also means that this\\nbehavior has existed in Firefox for at least one year.\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Since this isn't something Firefox seems to be fixing and the documentation\\nis lacking there isn't much to do aside from writing a workaround.\"\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Solving the problem\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"The value returned by \", _jsx(_components.code, {\n        children: \"document.fonts.entries()\"\n      }), \" in Firefox may not be \\\"officially\\\"\\niterable from the browser's own perspective, but it \", _jsx(_components.strong, {\n        children: \"does\"\n      }), \" have a \", _jsx(_components.code, {\n        children: \".next()\"\n      }), \"\\nmethod as is required per \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#the_iterator_protocol\",\n        children: \"iterator protocol\"\n      }), \".\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"So, instead of relying on the browser we write our own function which exhausts this fake \\\"iterator\\\":\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-javascript\",\n        children: \"function fontFaceSetIteratorToArray(target) {\\n    const iterable = target.entries();\\n    const results = [];\\n    let iterator = iterable.next();\\n\\n    while (iterator.done === false) {\\n        results.push(iterator.value);\\n\\n        iterator = iterable.next();\\n    }\\n\\n    return results;\\n}\\n\"\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Which means that in Firefox we can now finally loop over font faces ðŸŽ‰\"\n    }), \"\\n\", _jsx(_components.pre, {\n      children: _jsx(_components.code, {\n        className: \"language-javascript\",\n        children: \"console.log(fontFaceSetIteratorToArray(document.fonts));\\n\"\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"This piece of code works in all modern browsers so it can be used wherever\\nreferences to \", _jsx(_components.code, {\n        children: \"FontFaceSet.entries()\"\n      }), \" exist. It's not pretty, but it beats\\nwriting unreliable browser detection code.\"]\n    }), \"\\n\", _jsx(_components.h2, {\n      children: \"Conclusion\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Considering this is still an active problem in Firefox roughly a month before 2023,\\nusing spread syntax, \", _jsx(_components.code, {\n        children: \"for...of\"\n      }), \", or \", _jsx(_components.code, {\n        children: \"Array.from\"\n      }), \" on \", _jsx(_components.code, {\n        children: \"FontFaceSet.entries()\"\n      }), \" results is\\n\", _jsx(_components.strong, {\n        children: \"not viable\"\n      }), \" and instead a polyfill such as the one found in this article must be\\nused instead to ensure proper functionality across browsers.\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"It'll take some time before we can finally start using \", _jsx(_components.code, {\n        children: \"[...document.fonts.entries()]\"\n      }), \"\\nconsidering that even after closing the issue, we're still dependent on\\neveryone updating their browsers.\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"While this post does not end on a high note I do hope Firefox developers fix this\\nissue at some point so we can all enjoy the syntactically sugarcoated patterns\\nwe know and love :)\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"Until next time!\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"ðŸ‘‹\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\nfunction _missingMdxReference(id, component) {\n  throw new Error(\"Expected \" + (component ? \"component\" : \"object\") + \" `\" + id + \"` to be defined: you likely forgot to import, pass, or provide it.\");\n}\n","frontmatter":{},"scope":{"title":"Handling FontFaceSet.entries() result not being iterable in Firefox","description":"This post describes how to deal with a bug in Firefox where it fails to properly identify the result of \u003ccode\u003eFontFaceSet.entries()\u003c/code\u003e as an actual iterable object.","published":"2022-11-29T19:20:00Z"}},"slug":"fixing-font-face-set-entries-not-iterable-in-firefox"},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"fixing-font-face-set-entries-not-iterable-in-firefox"},"buildId":"cC1Szj2xy36RxrkTbSqf5","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>