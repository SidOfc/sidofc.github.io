<!DOCTYPE html><html lang="en"><head prefix="dc: http://purl.org/dc/elements/1.1# og: http://ogp.me/ns#"><meta charset="utf-8" /><link href="/atom.xml" rel="alternate" title="Sidney Liebrand's blog" type="application/atom+xml" /><link href="/feed.xml" rel="alternate" title="Sidney Liebrand's blog" type="application/rss+xml" /><link href="https://sidneyliebrand.io/blog/codi-vim-fullscreen-buffer" rel="canonical" /><link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180" type="image/png" /><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="/favicon.ico" rel="icon" sizes="48x48" type="image/icon" /><link href="/site.webmanifest" rel="manifest" /><meta content="#651eea" name="theme-color" /><meta content="index, follow" name="robots" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="https://sidneyliebrand.io/blog/codi-vim-fullscreen-buffer" name="og:url" /><meta content="Sidney Liebrand" name="author" /><meta content="Sidney Liebrand" name="dc:author" /><meta content="Sidney Liebrand" name="dc:creator" /><meta content="Learn how to set up Codi.vim to create a fullscreen scratch buffer that also works with Vim splits. We will take a look at wrapping the <code>Codi</code> command and improving the buffer name(s) as seen in <code>:ls</code>." name="description" /><meta content="Learn how to set up Codi.vim to create a fullscreen scratch buffer that also works with Vim splits. We will take a look at wrapping the <code>Codi</code> command and improving the buffer name(s) as seen in <code>:ls</code>." name="dc:description" /><meta content="Learn how to set up Codi.vim to create a fullscreen scratch buffer that also works with Vim splits. We will take a look at wrapping the <code>Codi</code> command and improving the buffer name(s) as seen in <code>:ls</code>." name="og:description" /><title>Codi.vim + fullscreen buffer</title><meta content="Codi.vim + fullscreen buffer" name="og:title" /><meta content="Codi.vim + fullscreen buffer" name="dc:title" /><style type="text/css">@charset UTF-8;html{min-height:100%;background-repeat:no-repeat;background-size:20%;font-size:14px}@media screen and (min-width:280px){html{font-size:calc(14px + 6*(100vw - 280px)/1160)}}@media screen and (min-width:1440px){html{font-size:20px}}body{margin:0;padding:0;min-height:100%;font-family:serif,Apple Color Emoji,Noto Color Emoji;line-height:1.6;font-weight:300}.fig-ar-container{position:relative;overflow:hidden;border-radius:4px}.fig-ar-lock{position:absolute;top:0;left:0;bottom:0;right:0;width:100%;height:100%;transition:opacity .25s ease-in-out}*{box-sizing:border-box}::-moz-selection{background-color:#f5f0fe;color:#3d0e94}::selection{background-color:#f5f0fe;color:#3d0e94}article,aside,details,figcaption,figure,footer,header,main,mark,nav,section{display:block}h1,h2,h3,h4,h5,h6{color:#000;line-height:1;font-family:sans-serif;font-weight:600;margin:2rem 0 .25rem}h1:not(:first-child),h2:not(:first-child),h3:not(:first-child),h4:not(:first-child),h5:not(:first-child),h6:not(:first-child){margin-top:2rem}h1+.highlighter-rouge,h1+p,h2+.highlighter-rouge,h2+p,h3+.highlighter-rouge,h3+p,h4+.highlighter-rouge,h4+p,h5+.highlighter-rouge,h5+p,h6+.highlighter-rouge,h6+p{margin-top:.5rem}h1{font-size:26px}@media screen and (min-width:280px){h1{font-size:calc(26px + 16*(100vw - 280px)/1160)}}@media screen and (min-width:1440px){h1{font-size:42px}}h2{font-size:22px}@media screen and (min-width:280px){h2{font-size:calc(22px + 12*(100vw - 280px)/1160)}}@media screen and (min-width:1440px){h2{font-size:34px}}h3{font-size:18px}@media screen and (min-width:280px){h3{font-size:calc(18px + 10*(100vw - 280px)/1160)}}@media screen and (min-width:1440px){h3{font-size:28px}}h4{font-size:15px}@media screen and (min-width:280px){h4{font-size:calc(15px + 9*(100vw - 280px)/1160)}}@media screen and (min-width:1440px){h4{font-size:24px}}h5{font-size:13px}@media screen and (min-width:280px){h5{font-size:calc(13px + 7*(100vw - 280px)/1160)}}@media screen and (min-width:1440px){h5{font-size:20px}}h6{font-size:1rem}p{font-size:1.15rem;margin-top:2rem;margin-bottom:2rem}p:first-child{margin-top:0}p:last-child{margin-bottom:0}li{margin-bottom:1rem}blockquote,li{font-size:1.15rem}code,kbd,pre{padding:.5rem 1rem;border-radius:4px;background-color:#f0f0f0;color:#444}code,kbd{font-size:.7em;padding:.2rem .4rem .15rem;border-radius:4px;vertical-align:middle}kbd{font-size:.6em;background-color:#fcfcfc;background-image:none;border:1px solid rgba(85,85,85,.3);padding-top:.1rem;padding-bottom:.2rem;box-shadow:inset 0 -1px #555}pre code{font-size:.9rem;padding:0;background-color:transparent;display:block}a,a>code{position:relative;color:#651eea;text-decoration:none;outline:none;transition:text-shadow .05s linear}a:hover,a:not(:active):focus,a>code:hover,a>code:not(:active):focus{text-shadow:-.06ex 0 #651eea,.06ex 0 #651eea}figure{margin:2rem 0}.no-js figure audio,.no-js figure img,.no-js figure video{opacity:1!important}figcaption{margin-top:.25rem;text-align:center;opacity:.8;font-size:.9rem;line-height:1}blockquote{font-style:italic;margin-top:2rem;margin-bottom:2rem;padding:0 2rem;border-left:4px solid #555}blockquote p{opacity:.8}@media (max-width:420px){blockquote{padding:1rem 0;border:4px solid #555;border-right:none;border-left:none}}strong{font-weight:600}img{max-width:100%}ol,ul{list-style:none;padding:0}ol li,ul li{position:relative;padding-left:1.5rem}ol li:before,ul li:before{position:absolute;line-height:1;padding-top:.25rem;top:0;left:0;bottom:0;width:1.5rem;font-size:1.4em;content:"â€¢";color:#555}ol{counter-reset:ol-li-counter}ol li:before{padding-top:.4rem;font-size:.9em;font-weight:600;counter-increment:ol-li-counter;content:counter(ol-li-counter) .}small{font-size:.8rem;font-family:sans-serif;line-height:1}.application{position:relative;min-height:100%;min-height:100vh;width:100%;display:grid;grid-template-columns:auto;grid-template-rows:3.125rem 1fr auto}.logo{display:inline-block;-ms-flex:0 1 6rem;flex:0 1 6rem;fill:#651eea}.logo,.logo figure{margin:0}.header{position:relative;height:3.125rem;width:100%}.header__inner{position:fixed;top:0;left:0;right:0;height:3.125rem;background-color:#fff;box-shadow:0 0 .25rem rgba(0,0,0,.15);z-index:100}.header__content{position:relative;width:100%;max-width:54rem;padding:0 0 0 1rem;margin:0 auto}.header__content,.header__nav{height:100%;-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex}.header__nav{margin-left:auto}.header__nav-item{position:relative;padding:0 1rem;height:100%;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;transition:all .2s ease-in-out}.header__nav-item:not(:active):focus:after{content:"";display:block;position:absolute;bottom:0;left:0;right:0;width:100%;height:4px;background-color:#651eea}.header__nav-item figure{margin:0;min-width:2rem}.main{position:relative;min-height:100%;min-height:100vh;color:#444;z-index:10}.page{margin:0 auto;width:54rem;max-width:calc(100% - 2rem);max-width:calc(100vw - 2rem);padding:1rem}.footer{color:#444;text-align:center;padding:.25rem 1rem}.article>:not(.wide){max-width:44rem;margin-left:auto;margin-right:auto}.article__title{margin-bottom:.25rem;font-size:34px}@media screen and (min-width:280px){.article__title{font-size:calc(34px + 11*(100vw - 280px)/1160)}}@media screen and (min-width:1440px){.article__title{font-size:45px}}.article__title+p{margin-top:0}.article__title+small{display:block}.highlighter-rouge{margin-top:2rem;margin-bottom:2rem}div.highlight{overflow:hidden;overflow-x:auto;border-radius:4px}div.highlight pre.highlight{margin:0}.posts{width:100%;max-width:44rem;margin:0 auto;padding:1rem 0}.post-card{position:relative;display:block;margin:0 auto;cursor:pointer;text-decoration:none;outline:none}.post-card:hover{text-shadow:none}.post-card+.post-card{margin-top:2rem}.post-card:not(:active):focus{opacity:1;text-shadow:none;box-shadow:inset 0 0 0 2px #651eea}.post-card__container{padding:1rem;display:-ms-flexbox;display:flex;-ms-flex-flow:column nowrap;flex-flow:column nowrap;color:#444;outline:none}.post-card__title{margin-top:0;font-size:20px}@media screen and (min-width:280px){.post-card__title{font-size:calc(20px + 8*(100vw - 280px)/1160)}}@media screen and (min-width:1440px){.post-card__title{font-size:28px}}.post-card__excerpt{margin-top:.5rem;margin-bottom:1rem;line-height:1.44}.post-card__view-post{margin-left:auto}.turbolinks-progress-bar{background-color:#651eea;transition:all .3s ease-in-out!important;opacity:.1!important;height:3.125rem}.button{display:inline-block;-webkit-appearance:none;-moz-appearance:none;appearance:none;line-height:1;font-weight:700;font-size:.8rem;font-family:sans-serif;padding:.625rem 2rem;border-radius:2px;height:auto;border:1px solid rgba(0,0,0,.1);background-color:#651eea;color:#fff;cursor:pointer;transition:all .1s ease-out;outline:none}.button:hover,.button:not(:active):focus{opacity:.8}.welcome-banner{position:relative;display:-ms-flexbox;display:flex;width:100%;max-width:54rem;margin:0 auto;-ms-flex-flow:row nowrap;flex-flow:row nowrap;-ms-flex-align:center;align-items:center;padding:2rem 1rem}.welcome-banner__graphic{-ms-flex:1 0 auto;flex:1 0 auto;width:100%;max-width:220px;overflow:hidden;margin:0;border-radius:100%}.welcome-banner__content{line-height:1.44;-ms-flex:1 1 auto;flex:1 1 auto;margin:auto 0 auto 2rem}@media (max-width:42rem){.welcome-banner{-ms-flex-flow:column nowrap;flex-flow:column nowrap}.welcome-banner:after{content:"";display:block;width:30%;position:absolute;bottom:-2px;left:35%;height:4px;background-color:#651eea;border-radius:8px}.welcome-banner__graphic{-ms-flex:1 1 auto;flex:1 1 auto;width:100%;max-width:220px;margin:0 auto}.welcome-banner__content{margin-left:0;text-align:center}}.highlight table td{padding:5px}.highlight table pre{margin:0}.highlight,.highlight .w{color:#f8f8f2;background-color:#272822}.highlight code{color:#f8f8f2}.highlight .err{color:#272822;background-color:#f92672}.highlight .c,.highlight .c1,.highlight .cd,.highlight .cm,.highlight .cs{color:#928f7f}.highlight .cp,.highlight .nt{color:#f4bf75}.highlight .o,.highlight .ow{color:#f8f8f2}.highlight .p,.highlight .pi{color:#a2a2a2}.highlight .gi{color:#a6e22e}.highlight .gd{color:#f92672}.highlight .gh{color:#66d9ef;background-color:#272822;font-weight:700}.highlight .k,.highlight .kn,.highlight .kp,.highlight .kr,.highlight .kv{color:#a57bf3}.highlight .kc,.highlight .kd,.highlight .kt{color:#fd971f}.highlight .s,.highlight .s1,.highlight .s2,.highlight .sb,.highlight .sc,.highlight .sd,.highlight .sh,.highlight .sx{color:#a6e22e}.highlight .sr{color:#a1efe4}.highlight .se,.highlight .si{color:#c63}.highlight .nc,.highlight .nn,.highlight .no{color:#f4bf75}.highlight .na{color:#66d9ef}.highlight .il,.highlight .m,.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .mo,.highlight .mx,.highlight .ss{color:#a6e22e}</style><script defer="true" type="text/javascript" src="/js/application-8c726ee35.js"></script></head><body class="no-js"><script>document.body.removeAttribute('class');</script><div class="application"><header class="header"><div class="header__inner"><div class="header__content"><a class="logo" href="/" title="Return to the home page"><figure><div class="fig-ar-container"><svg class="fig-ar-lock" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 429.29 114.44" preserveAspectRatio="xMidYMid slice"><path d="M33.43,96.21c18.22,0,25-17.14,8.48-26.76C29,61.94,11.44,60.75,3.93,46S3.07,12.14,17.4,4.71c15.35-8,36.69-5.08,51.36,3L62.4,24.49C53.63,19.59,41,16,31.08,19.76c-9.33,3.55-10.69,13.62-3.22,20.08,7.83,6.77,19.62,7.95,28.53,13,11.12,6.31,17.37,16.65,17.32,29.41-.12,27.84-27.22,34.19-50.28,31.69-6-.65-22.15-3.42-23.36-9.38C-.67,100.91,4.59,92,5.88,88.44A53,53,0,0,0,33.43,96.21Z" /><path d="M162,112.11H93.31V2.77h21.91V94.09H162Z" /><path d="M229.15,98.15c0,20.64-31.72,20.67-31.62,0C197.63,78,229.15,77.92,229.15,98.15Z" /><path d="M267,112.11v-18H290.8V20.78H267v-18h69.42v18H312.7V94.09h23.67v18Z" /><path d="M350.5,57.35c0-25.51,8.42-57,39.39-57.06,31.32-.09,39.4,31.31,39.4,57.06,0,24.69-7.42,55.53-37.19,57C359.55,115.88,350.5,84,350.5,57.35Zm22.08,0c0,12.19-.62,38.21,17.31,38.15s17.3-25.85,17.32-38.15.62-38.12-17.32-38.16S372.58,45.23,372.58,57.35Z" /></svg>
<div style="padding-bottom:26.57%;visibility:hidden"></div></div></figure></a><nav class="header__nav"><a class="header__nav-item" href="https://github.com/SidOfc" rel="noopener,noreferrer" target="_blank" title="Sidney Liebrand's github profile"><figure><div class="fig-ar-container"><svg class="fig-ar-lock" viewBox="0 0 16 16" version="1.1" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
<div style="padding-bottom:100.0%;visibility:hidden"></div></div></figure></a></nav></div></div></header><main class="main"><article class="page article"><h1 class="article__title">Codi.vim + fullscreen buffer</h1><small>By Sidney Liebrand on Aug 27, 2018 &nbsp;&bull;&nbsp; 4 min read</small><figure class="wide"><div class="fig-ar-container"><img class="fig-ar-lock" style="opacity:0" onload="this.style.opacity=1" src="/img/posts/codi-banner-16f892783.png" alt="A Codi.vim fullscreen buffer" /><div style="padding-bottom:58.13%;visibility:hidden"></div></div><figcaption>A Codi.vim fullscreen buffer</figcaption></figure>

<p>Recently I discovered <a href="https://github.com/metakirby5/codi.vim">codi.vim</a> on <a href="https://vimawesome.com/?q=cat%3Aother">vimawesome.com</a>.
It sells itself as an "interactive scratchpad for hackers".
After playing around with it for 5 minutes I was completely sold.</p>

<p>I pair program on a weekly basis using various different languages.
I used to turn to a REPL for help but this quickly becomes annoying when trying to write multi-line expressions.
Making a typo in the middle of a <code>do ... end</code> block in Ruby is quite costly:</p>

<figure><div class="fig-ar-container"><video style="opacity: 0" oncanplaythrough="this.style.opacity=1" class="fig-ar-lock" autoplay="true" loop="true" muted="true" playsinline="true"><source src="/img/posts/pry-multiline-typo-22c997ce1.webm" type="video/webm" /><source src="/img/posts/pry-multiline-typo-9844105f3.mp4" type="video/mp4" /></video><div style="padding-bottom:24.2%;visibility:hidden"></div></div><figcaption>Multiline expression typo in Pry</figcaption></figure>

<p>Another thing to note here is that code and results are printed sequentially.
This means that any code you write goes off-screen at least twice as fast because the result is printed below it.</p>

<p>In case of errors and stack traces it can become a lot worse as well.
Codi solves all of this by allowing you to type in one pane and it prints the results in a separate pane side-by-side:</p>

<figure><div class="fig-ar-container"><video style="opacity: 0" oncanplaythrough="this.style.opacity=1" class="fig-ar-lock" autoplay="true" loop="true" muted="true" playsinline="true"><source src="/img/posts/ruby-demo-7c6bc86a0.webm" type="video/webm" /><source src="/img/posts/ruby-demo-942ed3771.mp4" type="video/mp4" /></video><div style="padding-bottom:13.65%;visibility:hidden"></div></div><figcaption>Demo of Ruby in Codi.vim</figcaption></figure>

<p>This feature, and the fact that I can toggle this buffer for <em>multiple programming languages</em> using a single mapping blew my mind but as with anything,
it requires some more battle testing to see if it works in common scenario's.</p>

<h2 id="battle-testing">Battle testing</h2>

<p>This is where I found out that when used with a split, it will not be fullscreen but rather split the current buffer:</p>

<figure><div class="fig-ar-container"><video style="opacity: 0" oncanplaythrough="this.style.opacity=1" class="fig-ar-lock" autoplay="true" loop="true" muted="true" playsinline="true"><source src="/img/posts/split-behavior-3d6f68841.webm" type="video/webm" /><source src="/img/posts/split-behavior-76ab1804b.mp4" type="video/mp4" /></video><div style="padding-bottom:48.02%;visibility:hidden"></div></div><figcaption>Default split behaviour</figcaption></figure>

<p>At this point I started experimenting with a small <a href="https://gist.github.com/SidOfc/5218a7a9f12ed2105a9b052ca8e6707e">vimscript snippet</a> in my .vimrc.
Excluding comments and blanks it is 10 LoC.
It wraps the default <code>Codi</code> command in a function which creates an empty buffer in a new tab with the right filetype set before finally running <code>Codi</code> itself.
This creates the fullscreen split that I wanted:</p>

<figure><div class="fig-ar-container"><video style="opacity: 0" oncanplaythrough="this.style.opacity=1" class="fig-ar-lock" autoplay="true" loop="true" muted="true" playsinline="true"><source src="/img/posts/wrapped-split-behavior-3b2f08ab9.webm" type="video/webm" /><source src="/img/posts/wrapped-split-behavior-91450156a.mp4" type="video/mp4" /></video><div style="padding-bottom:48.02%;visibility:hidden"></div></div><figcaption>Enhanced split behaviour</figcaption></figure>

<h2 id="problem-solved-or-maybe-not">Problem solved, or maybe not?</h2>

<p>All good so far, but upon closing the buffer, the contents of the buffer are deleted.
While automatically clearing the scratchpad is nice, sometimes I want to go back and forth between the code and the scratchpad to add additional code or compare the existing code with the scratchpad code.</p>

<p>This required a <a href="https://gist.github.com/SidOfc/3f94244a8b08406710b6669052f66d62">second iteration</a> of the original vimscript snippet.
This time I did not want to delete the buffer but hide it instead, keeping the code that was already written in it.
After hiding the buffer, its <code>tabpagenr()</code> is stored in a dictionary keyed by the filetype of the buffer.</p>

<p>Then, when toggling codi for a filetype that is stored, switch to that tab instead of opening a new one (there is even a check if that tab actually exists):</p>

<figure><div class="fig-ar-container"><video style="opacity: 0" oncanplaythrough="this.style.opacity=1" class="fig-ar-lock" autoplay="true" loop="true" muted="true" playsinline="true"><source src="/img/posts/wrapped-split-behavior-2-85e1f66af.webm" type="video/webm" /><source src="/img/posts/wrapped-split-behavior-2-ae7b5a0d4.mp4" type="video/mp4" /></video><div style="padding-bottom:48.02%;visibility:hidden"></div></div><figcaption>Enhanced split behaviour version 2</figcaption></figure>

<p>And there we go! Aside from the fact that the buffer now remains, the name is also <code>scratch::ruby</code>.
This is a bit more descriptive than having just <code>[Scratch]</code> in <code>:ls</code> output when multiple codi buffers of a different filetype are active.</p>

<h2 id="lets-wrap-it-in-an-issue">Let's wrap it in an issue</h2>

<p>It was a fun experience tweaking this plugin to my liking.
I thought this feature would be so awesome that I even proposed it in an <a href="https://github.com/metakirby5/codi.vim/issues/9://github.com/metakirby5/codi.vim/issues/94">issue</a>.
Unfortunately it didn't make it since it was too workflow specific.</p>

<p>As you may have been able to see in the issue though, the code in that snippet is <em>slighty</em> different from the example gist linked in this post.
The main difference is this line which resizes codi to 50% of the buffer width whenever a new instance is spawned:</p>

<div class="language-vim highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">" since it is fullscreen, I'd like a 50/50 split</span>
<span class="k">let</span> <span class="nv">g:codi</span>#width <span class="p">=</span> winwidth<span class="p">(</span>winnr<span class="p">())</span> / <span class="m">2</span>
</code></pre></div></div>

<p>The author thought it would be a nice addition to have percentage width support and for the snippets to live elsewhere for others to use in their .vimrc.
So I went ahead and <a href="https://github.com/metakirby5/codi.vim/pull/95">wrote a PR</a> for that instead, this is why you see
<code>let g:codi#width = 50.0</code> in the gists :)</p>

<h2 id="conclusion">Conclusion</h2>

<p>All in all it was a great experience discovering this plugin.
It is like one of those rare cases with a song where after a few seconds <strong>you just know</strong> <em>"this song is awesome"</em>.
I believe I'll be using it for a long time to come for quickly testing and showing some code.</p>

<p>This also gave me the chance to write my first non-organization bound PR for a project which I like and now also use.
Something which I wanted to do for a long time but couldn't really find the right project to contribute to.
I want to thank <a href="https://medium.com/@metakirby5">Ethan Chan</a> for his awesome plugin and for being a kind and friendly maintainer!</p>

<p>That's it! If you want a fullscreen workflow with codi.vim, you have it.
If you want to persist the code in the buffer, you have it.
If you have a great idea, comment on this post!</p>

<p>Until next time.</p>

<p>ðŸ‘‹</p><footer><a class="button" href="/">Back</a></footer></article></main><footer class="footer"><small>&copy; https://sidneyliebrand.io 2019</small></footer></div></body></html>