<!DOCTYPE html><html lang="en" class="no-js"><head><meta charSet="utf-8"/><title>Sidney Liebrand&#x27;s blog - Building a Next.js page load progress bar</title><link rel="canonical" href="https://sidneyliebrand.io/blog/building-a-next-js-page-load-progress-bar"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#a676ff"/><link rel="icon" sizes="48x48" type="image/icon" href="/favicon.ico"/><link rel="icon" sizes="16x16" type="image/png" href="/favicon-16x16.png"/><link rel="icon" sizes="32x32" type="image/png" href="/favicon-32x32.png"/><link rel="apple-touch-icon" sizes="180x180" type="image/png" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" title="The official https://sidneyliebrand.io Atom feed" href="/atom.xml"/><link rel="alternate" type="application/rss+xml" title="The official https://sidneyliebrand.io RSS feed" href="/feed.xml"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="theme-color" content="#ffffff"/><meta name="msapplication-TileColor" content="#ffc40d"/><meta name="robots" content="index, follow"/><meta name="author" content="Sidney Liebrand"/><meta name="description" content="I&#x27;ve seen a fair few tutorials on building a page load progress bar for Next.js applications but most of them use the external library NProgress. While NProgress is a very nice general purpose library we can also build our own &#x27;cheap&#x27; progress bar without using any library!"/><meta property="og:title" content="Building a Next.js page load progress bar"/><meta property="og:type" content="website"/><meta property="og:url" content="https://sidneyliebrand.io"/><meta property="og:site_name" content="https://sidneyliebrand.io"/><meta property="og:description" content="I&#x27;ve seen a fair few tutorials on building a page load progress bar for Next.js applications but most of them use the external library NProgress. While NProgress is a very nice general purpose library we can also build our own &#x27;cheap&#x27; progress bar without using any library!"/><meta name="dc:creator" content="Sidney Liebrand"/><meta name="dc:title" content="Building a Next.js page load progress bar"/><meta name="dc:description" content="I&#x27;ve seen a fair few tutorials on building a page load progress bar for Next.js applications but most of them use the external library NProgress. While NProgress is a very nice general purpose library we can also build our own &#x27;cheap&#x27; progress bar without using any library!"/><meta name="twitter:card" content="summary"/><meta name="twitter:creator" content="@scbydoooo"/><meta name="next-head-count" content="27"/><script>window.themeBackgrounds={light:"#efefef",dark:"#111"},window.themeNames=Object.keys(themeBackgrounds),function(){var e,a=window.themeBackgrounds||{},c=Object.keys(a),t=document,n=t.querySelector("html"),o=t.createElement("style");try{e=localStorage.getItem("theme")}catch(e){}function r(e,t){if(c.forEach(function(e){n.classList.remove(e)}),e&&(n.classList.add(e),o.innerHTML="html { background-color:"+a[e]+"; }"),t)try{e?localStorage.setItem("theme",e):localStorage.removeItem("theme")}catch(e){}}e=e||"light",n.classList.remove("no-js"),t.head.appendChild(o),window.addEventListener("click",function(e){e=e.target.getAttribute("data-theme");e&&r(e,!0)}),window.addEventListener("storage",function(e){"theme"===e.key&&r(e.newValue)}),window.matchMedia&&(t=window.matchMedia("(prefers-color-scheme: dark)"),!e&&t.matches&&(e="dark"),t.addEventListener("change",function(e){try{localStorage.getItem("theme")||r(e.matches?"dark":"light")}catch(e){}})),r(e)}();</script><link rel="preload" href="/_next/static/css/be8146b5585d7977.css" as="style"/><link rel="stylesheet" href="/_next/static/css/be8146b5585d7977.css" data-n-g=""/><link rel="preload" href="/_next/static/css/e122d7ef55bd60cf.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e122d7ef55bd60cf.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-05801a00de84d316.js" defer=""></script><script src="/_next/static/chunks/framework-01395af778c6fb71.js" defer=""></script><script src="/_next/static/chunks/main-e8c39d39ad5622e4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d663e25d8809170c.js" defer=""></script><script src="/_next/static/chunks/745-d508635f4a78bdae.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-1b66884345b12fc5.js" defer=""></script><script src="/_next/static/jUbFVT5Bn9Op0e0TGvL_l/_buildManifest.js" defer=""></script><script src="/_next/static/jUbFVT5Bn9Op0e0TGvL_l/_ssgManifest.js" defer=""></script><script src="/_next/static/jUbFVT5Bn9Op0e0TGvL_l/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="layout_application__dwRj8"><header class="layout_header__PamGz"><div class="layout_headerFixed__9jfXi"><div class="layout_headerContent__QnbZ2"><a class="layout_logo__aPV1g" title="View home page" href="/"><span class="layout_logoTopLeft___eyDK"></span><span class="layout_logoBottomLeft__I65pR"></span><span class="layout_logoTopRight__oke9p"></span><span class="layout_logoBottomRight__eVOXL"></span></a><nav class="layout_navigation__ACKPn"><a title="View curriculum vitae" href="/cv">C.V.</a><a title="Visit Sidney Liebrand&#x27;s GitHub page" href="https://github.com/SidOfc"><figure class="layout_github__8SImE media_figure__xGL2a media_invertDark__E_DwP"><div class="media_relative__TC0n4" style="padding-bottom:100%"><img loading="lazy" class="media_media__tGftk" src="/media/github.svg" alt="Sidney Liebrand&#x27;s GitHub page"/></div></figure></a><div tabindex="0" title="Toggle dark theme" class="dark-mode-toggle_wrapper__EPTcL"><svg fill="#000000" data-theme="light" class="dark-mode-toggle_toggle__lj_e6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"></path><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"></path></svg><svg fill="#000000" data-theme="dark" class="dark-mode-toggle_toggle__lj_e6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"></path><path d="M9.5,2c-1.82,0-3.53,0.5-5,1.35c2.99,1.73,5,4.95,5,8.65s-2.01,6.92-5,8.65C5.97,21.5,7.68,22,9.5,22c5.52,0,10-4.48,10-10 S15.02,2,9.5,2z"></path></svg></div></nav></div></div></header><main class="layout_content__M_5eu"><article class="post_post__blG85"><h1 class="heading_container__rXliZ"><a class="heading_link__lpFzm" href="/blog/building-a-next-js-page-load-progress-bar">Building a Next.js page load progress bar</a></h1><span class="post_postData__6yOKI text_page-accent-fg__N0I1H">By Sidney Liebrand on<!-- --> <!-- -->Apr 18, 2021<span class="bullet_bullet__k7HK1">â€¢</span>7<!-- --> min read</span><section><p>In this post I&#x27;m going to cover why you would want to add a page load progress bar
to your Next.js application as well as how you could go about implementing it
without using any external libraries. Let&#x27;s dive right in!</p>
<h1 class="heading_container__rXliZ"><a class="heading_anchor__e_uQU" id="why-add-a-page-load-progress-bar"></a><a class="heading_link__lpFzm" href="#why-add-a-page-load-progress-bar">Why add a page load progress bar</a></h1>
<p>If you&#x27;ve ever visited a slow website and clicked a navigation link,
it may have felt like the page was not responding. This might have given
you a certain feeling of frustration perhaps, even provoking you to click
one or multiple times.</p>
<p>What really happened in the background was that the server got your request
and started preparing this page on the back-end but it just took a while to
complete. Since you didn&#x27;t get any kind of indication that something was happening
you just decided to mash that button again.</p>
<p>In the worst case the webserver actually starts processing this second
click for the exact same page as well, needlessly increasing server load.
This implies two negative side effects. First, the webserver processed
a request twice, and second, the user has become more impatient than
they already were due to poor loading experience.</p>
<p>Of course the button could just be disabled on click, while this does
prevent the user from rage clicking it doesn&#x27;t improve their browsing
experience on your website at all. This is why it may help to show
your users a page load progress bar.</p>
<h1 class="heading_container__rXliZ"><a class="heading_anchor__e_uQU" id="implementing-the-page-load-progress-bar"></a><a class="heading_link__lpFzm" href="#implementing-the-page-load-progress-bar">Implementing the page load progress bar</a></h1>
<p>For this part I will be using Next.js&#x27; built-in support for CSS modules
and the provided <code>useRouter</code> hook so that we can hook into router events
provided by Next.js. The choice of CSS library is completely yours, you
could opt to use styled-jsx or styled-components if you&#x27;d like.
Furthermore this will be a self-contained component, when it&#x27;s done you
can just drop <code>&lt;Progress /&gt;</code> into your Next.js page layout file and
everything should just work.</p>
<h2 class="heading_container__rXliZ"><a class="heading_anchor__e_uQU" id="setting-up-the-component"></a><a class="heading_link__lpFzm" href="#setting-up-the-component">Setting up the component</a></h2>
<p>To start off, let&#x27;s first create the files we need for this component.
I&#x27;ll assume you have some folder such as <code>components/</code> which holds all
your React components. Add a <code>progress/</code> folder inside this folder and
add an <code>index.js</code> and <code>progress.module.css</code> file to the <code>progress/</code> folder.
Your directory structure should look like this:</p>
<pre class="prism-code language-plain"><div class="token-line"><span class="token plain">. (root)</span></div><div class="token-line"><span class="token plain">|- components</span></div><div class="token-line"><span class="token plain">|--|- progress</span></div><div class="token-line"><span class="token plain">|--|--|- index.js</span></div><div class="token-line"><span class="token plain">|--|--|- progress.module.css</span></div></pre>
<p>With these files set up we can now open <code>progress/index.js</code> to start
working on our component. We&#x27;ll need to use the <code>useRouter</code> and <code>useEffect</code> hooks
to bind listeners to navigation events and we&#x27;ll need to use <code>useState</code>
to keep track of the progress:</p>
<pre class="prism-code language-jsx"><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">useEffect</span><span class="token punctuation">,</span><span class="token plain"> useState</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">useRouter</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;next/router&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> styles </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./progress.module.css&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">Progress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> router </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">progress</span><span class="token punctuation">,</span><span class="token plain"> setProgress</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">styles</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript">progress</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></div><div class="token-line"><span class="token plain-text">            </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">                </span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">styles</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript">indicator</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">                </span><span class="token tag attr-name">style</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">                    </span><span class="token tag script language-javascript literal-property property">width</span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">progress</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string string">%</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">,</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">                    </span><span class="token tag script language-javascript literal-property property">opacity</span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"> progress </span><span class="token tag script language-javascript operator">&gt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript number">0</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">&amp;&amp;</span><span class="token tag script language-javascript"> progress </span><span class="token tag script language-javascript operator">&lt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript number">100</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">?</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript number">1</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript number">0</span><span class="token tag script language-javascript punctuation">,</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">                </span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">            </span><span class="token tag punctuation">/&gt;</span><span class="token plain-text"></span></div><div class="token-line"><span class="token plain-text">        </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre>
<p>Of course this doesn&#x27;t do much yet but at least we now have a component
that we can <code>import</code> in our layout or header file. We did set up
a little bit of dynamic styling in the <code>.indicator</code> element so set
the <code>width</code> equal to <code>${progress}%</code> and to set <code>opacity</code> to <code>1</code> whenever
it is active (<code>progress</code> not <code>0</code> or <code>100</code>). You can go ahead
and import and render it on your page. Nothing will show up yet but we&#x27;re
going to fix that now by adding some CSS.</p>
<h2 class="heading_container__rXliZ"><a class="heading_anchor__e_uQU" id="styling-the-component"></a><a class="heading_link__lpFzm" href="#styling-the-component">Styling the component</a></h2>
<p>Open <code>progress/progress.module.css</code> and add the following:</p>
<pre class="prism-code language-css"><div class="token-line"><span class="token selector class">.progress</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">position</span><span class="token punctuation">:</span><span class="token plain"> fixed</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">top</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">left</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">z-index</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">999999</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">height</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0.15</span><span class="token unit">rem</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">width</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token selector class">.indicator</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">background-color</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token color">yellow</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">position</span><span class="token punctuation">:</span><span class="token plain"> absolute</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">top</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">bottom</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">left</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">width</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">transition</span><span class="token punctuation">:</span><span class="token plain"> all </span><span class="token number">0.1</span><span class="token unit">s</span><span class="token plain"> linear</span><span class="token punctuation">,</span><span class="token plain"> opacity </span><span class="token number">0.3</span><span class="token unit">s</span><span class="token plain"> linear </span><span class="token number">0.2</span><span class="token unit">s</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre>
<p>The <code>.progress</code> class is the outer container which will create a fixed
space at the top of the page which <code>.indicator</code> will fill up. The
<code>.indicator</code> has some transition effects to animate both <code>width</code> and
<code>opacity</code> so the bar fades in and out nicely and width transitions
also look smooth. If we now go ahead and set the progress to something
other than <code>0</code> initially, we should see a yellow bar at the top,
let&#x27;s set it to <code>40</code>:</p>
<pre class="prism-code language-jsx"><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">progress</span><span class="token punctuation">,</span><span class="token plain"> setProgress</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre>
<p>Now reload the page and you should see a progress bar already at 40% progress.
This is the time you&#x27;ll want to do some additional styling if you don&#x27;t like
how it looks. Also don&#x27;t forget to set the <code>useState</code> default back to <code>0</code>
when you&#x27;re done :)</p>
<h2 class="heading_container__rXliZ"><a class="heading_anchor__e_uQU" id="binding-the-events"></a><a class="heading_link__lpFzm" href="#binding-the-events">Binding the events</a></h2>
<p>All we have to do now is to hook up to Next.js&#x27; router events
and make this bar move on its own whenever a navigation event occurs. To
do this we&#x27;ll add a <code>useEffect</code> hook without any dependencies so that
it works like <a href="https://reactjs.org/docs/react-component.html#componentdidmount"><code>componentDidMount</code></a>
/ <a href="https://reactjs.org/docs/react-component.html#componentwillunmount"><code>componentWillUnmount</code></a>
lifecycle methods.</p>
<p>We do this since we want
to make sure these listeners are only bound once, and should an unmount
occur we also want to make sure the old listeners are cleaned up
before any new ones are attached. This allows us to set up the listeners once,
and if an unmount occurs this also allows us to clean up the listeners:</p>
<pre class="prism-code language-jsx"><div class="token-line"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">let</span><span class="token plain"> timer</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> timeout </span><span class="token operator">=</span><span class="token plain"> Math</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token plain">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">progress</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">const</span><span class="token plain"> percent </span><span class="token operator">=</span><span class="token plain"> Math</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token plain">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">const</span><span class="token plain"> next </span><span class="token operator">=</span><span class="token plain"> Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token plain">progress </span><span class="token operator">+</span><span class="token plain"> percent</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">next </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">80</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                timer </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token plain">increment</span><span class="token punctuation">,</span><span class="token plain"> timeout</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token keyword">return</span><span class="token plain"> next</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token number">80</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token plain">timer</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    router</span><span class="token punctuation">.</span><span class="token plain">events</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#x27;routeChangeStart&#x27;</span><span class="token punctuation">,</span><span class="token plain"> start</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    router</span><span class="token punctuation">.</span><span class="token plain">events</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#x27;routeChangeComplete&#x27;</span><span class="token punctuation">,</span><span class="token plain"> complete</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    router</span><span class="token punctuation">.</span><span class="token plain">events</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#x27;routeChangeError&#x27;</span><span class="token punctuation">,</span><span class="token plain"> complete</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token plain">timer</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        router</span><span class="token punctuation">.</span><span class="token plain">events</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#x27;routeChangeStart&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        router</span><span class="token punctuation">.</span><span class="token plain">events</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#x27;routeChangeComplete&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        router</span><span class="token punctuation">.</span><span class="token plain">events</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#x27;routeChangeError&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre>
<p>With all the parts set up we can now go over the <code>start</code>, <code>increment</code> and
<code>complete</code> functions. The <code>start</code> function kicks off the process on
<code>routeChangeStart</code>. It calls <code>setProgress(1)</code> which makes the progress bar
visible after a 0.2s delay defined in the CSS <code>opacity</code> transition.
Afterwards, it also calls <code>increment()</code> which will repeatedly call itself
using <code>setTimeout</code> until a certain threshold has been reached (<code>80</code> in this case).
This will move the progress bar at random intervals with random percentages added.</p>
<p>Finally the <code>complete</code> function will be called either on <code>routeChangeComplete</code>
or <code>routeChangeError</code> which will clear any remaining timeout set by <code>increment</code>
and force the bar to <code>100</code> progress causing it to fill up and fade out.</p>
<p>We can safely leave <code>progress</code> at <code>100</code> here. There is no need to reset it
to <code>0</code> because in our component logic we set <code>opacity</code> to <code>0</code> when the bar
is either at <code>0</code> or <code>100</code> progress. Additionally when new navigation events
occur the <code>start</code> function is called which always sets it to <code>1</code>.</p>
<h1 class="heading_container__rXliZ"><a class="heading_anchor__e_uQU" id="everything-together"></a><a class="heading_link__lpFzm" href="#everything-together">Everything together</a></h1>
<p>Finally, you&#x27;ll end up with this component:</p>
<pre class="prism-code language-jsx"><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">useEffect</span><span class="token punctuation">,</span><span class="token plain"> useState</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;react&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain">useRouter</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;next/router&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> styles </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&#x27;./progress.module.css&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">export</span><span class="token plain"> </span><span class="token keyword">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">Progress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> router </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">progress</span><span class="token punctuation">,</span><span class="token plain"> setProgress</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">let</span><span class="token plain"> timer</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">const</span><span class="token plain"> timeout </span><span class="token operator">=</span><span class="token plain"> Math</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token plain">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">            </span><span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">progress</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token keyword">const</span><span class="token plain"> percent </span><span class="token operator">=</span><span class="token plain"> Math</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token plain">Math</span><span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token keyword">const</span><span class="token plain"> next </span><span class="token operator">=</span><span class="token plain"> Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token plain">progress </span><span class="token operator">+</span><span class="token plain"> percent</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">                </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">next </span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token number">80</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                    timer </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token plain">increment</span><span class="token punctuation">,</span><span class="token plain"> timeout</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                    </span><span class="token keyword">return</span><span class="token plain"> next</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">                </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token number">80</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token plain">timer</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        router</span><span class="token punctuation">.</span><span class="token plain">events</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#x27;routeChangeStart&#x27;</span><span class="token punctuation">,</span><span class="token plain"> start</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        router</span><span class="token punctuation">.</span><span class="token plain">events</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#x27;routeChangeComplete&#x27;</span><span class="token punctuation">,</span><span class="token plain"> complete</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        router</span><span class="token punctuation">.</span><span class="token plain">events</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#x27;routeChangeError&#x27;</span><span class="token punctuation">,</span><span class="token plain"> complete</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token plain">timer</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            router</span><span class="token punctuation">.</span><span class="token plain">events</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#x27;routeChangeStart&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            router</span><span class="token punctuation">.</span><span class="token plain">events</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#x27;routeChangeComplete&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            router</span><span class="token punctuation">.</span><span class="token plain">events</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">&#x27;routeChangeError&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">styles</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript">progress</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></div><div class="token-line"><span class="token plain-text">            </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">                </span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">styles</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript">indicator</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">                </span><span class="token tag attr-name">style</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">                    </span><span class="token tag script language-javascript literal-property property">width</span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation">progress</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string string">%</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">,</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">                    </span><span class="token tag script language-javascript literal-property property">opacity</span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"> progress </span><span class="token tag script language-javascript operator">&gt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript number">0</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">&amp;&amp;</span><span class="token tag script language-javascript"> progress </span><span class="token tag script language-javascript operator">&lt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript number">100</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">?</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript number">1</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript number">0</span><span class="token tag script language-javascript punctuation">,</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">                </span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">            </span><span class="token tag punctuation">/&gt;</span><span class="token plain-text"></span></div><div class="token-line"><span class="token plain-text">        </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre>
<p>While it isn&#x27;t as fancy as something like <a href="https://github.com/rstacruz/nprogress">NProgress</a>,
which also shows a loading spinner, it doesn&#x27;t require any library and it is
also less JS and CSS. Adding an endless spinner here also wouldn&#x27;t be too
difficult if you really wanted to but this is something I&#x27;ll leave
as an exercise for the reader :)</p>
<p>If you&#x27;ve got any questions, feel free to hit me up on Twitter <a href="https://twitter.com/scbydoooo">@scbydoooo</a>.</p>
<p>Until next time!</p>
<p>ðŸ‘‹</p></section><a tabindex="0" class="button_button__eJwei" href="/">Back</a></article></main><footer class="layout_footer__U7ng8"><strong>Â©</strong> sidneyliebrand.io<!-- --> <!-- -->2022<span class="bullet_bullet__k7HK1 bullet_wide__C2XLP">â€¢</span><a title="View RSS feed" href="/feed.xml">RSS</a><span class="bullet_bullet__k7HK1 bullet_wide__C2XLP">â€¢</span><a title="View Atom feed" href="/atom.xml">Atom</a></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Building a Next.js page load progress bar","description":"I've seen a fair few tutorials on building a page load progress bar for Next.js applications but most of them use the external library NProgress. While NProgress is a very nice general purpose library we can also build our own 'cheap' progress bar without using any library!","published":"2021-04-18T19:00:00Z","readTimeInMinutes":7,"source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      p: \"p\",\n      h1: \"h1\",\n      code: \"code\",\n      h2: \"h2\",\n      pre: \"pre\",\n      a: \"a\"\n    }, _provideComponents(), props.components);\n    return _jsxs(_Fragment, {\n      children: [_jsx(_components.p, {\n        children: \"In this post I'm going to cover why you would want to add a page load progress bar\\nto your Next.js application as well as how you could go about implementing it\\nwithout using any external libraries. Let's dive right in!\"\n      }), \"\\n\", _jsx(_components.h1, {\n        children: \"Why add a page load progress bar\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"If you've ever visited a slow website and clicked a navigation link,\\nit may have felt like the page was not responding. This might have given\\nyou a certain feeling of frustration perhaps, even provoking you to click\\none or multiple times.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"What really happened in the background was that the server got your request\\nand started preparing this page on the back-end but it just took a while to\\ncomplete. Since you didn't get any kind of indication that something was happening\\nyou just decided to mash that button again.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"In the worst case the webserver actually starts processing this second\\nclick for the exact same page as well, needlessly increasing server load.\\nThis implies two negative side effects. First, the webserver processed\\na request twice, and second, the user has become more impatient than\\nthey already were due to poor loading experience.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Of course the button could just be disabled on click, while this does\\nprevent the user from rage clicking it doesn't improve their browsing\\nexperience on your website at all. This is why it may help to show\\nyour users a page load progress bar.\"\n      }), \"\\n\", _jsx(_components.h1, {\n        children: \"Implementing the page load progress bar\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"For this part I will be using Next.js' built-in support for CSS modules\\nand the provided \", _jsx(_components.code, {\n          children: \"useRouter\"\n        }), \" hook so that we can hook into router events\\nprovided by Next.js. The choice of CSS library is completely yours, you\\ncould opt to use styled-jsx or styled-components if you'd like.\\nFurthermore this will be a self-contained component, when it's done you\\ncan just drop \", _jsx(_components.code, {\n          children: \"\u003cProgress /\u003e\"\n        }), \" into your Next.js page layout file and\\neverything should just work.\"]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Setting up the component\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"To start off, let's first create the files we need for this component.\\nI'll assume you have some folder such as \", _jsx(_components.code, {\n          children: \"components/\"\n        }), \" which holds all\\nyour React components. Add a \", _jsx(_components.code, {\n          children: \"progress/\"\n        }), \" folder inside this folder and\\nadd an \", _jsx(_components.code, {\n          children: \"index.js\"\n        }), \" and \", _jsx(_components.code, {\n          children: \"progress.module.css\"\n        }), \" file to the \", _jsx(_components.code, {\n          children: \"progress/\"\n        }), \" folder.\\nYour directory structure should look like this:\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-plain\",\n          children: \". (root)\\n|- components\\n|--|- progress\\n|--|--|- index.js\\n|--|--|- progress.module.css\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"With these files set up we can now open \", _jsx(_components.code, {\n          children: \"progress/index.js\"\n        }), \" to start\\nworking on our component. We'll need to use the \", _jsx(_components.code, {\n          children: \"useRouter\"\n        }), \" and \", _jsx(_components.code, {\n          children: \"useEffect\"\n        }), \" hooks\\nto bind listeners to navigation events and we'll need to use \", _jsx(_components.code, {\n          children: \"useState\"\n        }), \"\\nto keep track of the progress:\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-jsx\",\n          children: \"import {useEffect, useState} from 'react';\\nimport {useRouter} from 'next/router';\\nimport styles from './progress.module.css';\\n\\nexport default function Progress() {\\n    const router = useRouter();\\n    const [progress, setProgress] = useState(0);\\n\\n    return (\\n        \u003cdiv className={styles.progress}\u003e\\n            \u003cdiv\\n                className={styles.indicator}\\n                style={{\\n                    width: `${progress}%`,\\n                    opacity: progress \u003e 0 \u0026\u0026 progress \u003c 100 ? 1 : 0,\\n                }}\\n            /\u003e\\n        \u003c/div\u003e\\n    )\\n}\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Of course this doesn't do much yet but at least we now have a component\\nthat we can \", _jsx(_components.code, {\n          children: \"import\"\n        }), \" in our layout or header file. We did set up\\na little bit of dynamic styling in the \", _jsx(_components.code, {\n          children: \".indicator\"\n        }), \" element so set\\nthe \", _jsx(_components.code, {\n          children: \"width\"\n        }), \" equal to \", _jsx(_components.code, {\n          children: \"${progress}%\"\n        }), \" and to set \", _jsx(_components.code, {\n          children: \"opacity\"\n        }), \" to \", _jsx(_components.code, {\n          children: \"1\"\n        }), \" whenever\\nit is active (\", _jsx(_components.code, {\n          children: \"progress\"\n        }), \" not \", _jsx(_components.code, {\n          children: \"0\"\n        }), \" or \", _jsx(_components.code, {\n          children: \"100\"\n        }), \"). You can go ahead\\nand import and render it on your page. Nothing will show up yet but we're\\ngoing to fix that now by adding some CSS.\"]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Styling the component\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Open \", _jsx(_components.code, {\n          children: \"progress/progress.module.css\"\n        }), \" and add the following:\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-css\",\n          children: \".progress {\\n  position: fixed;\\n  top: 0;\\n  left: 0;\\n  z-index: 999999;\\n  height: 0.15rem;\\n  width: 100%;\\n}\\n\\n.indicator {\\n  background-color: yellow;\\n  position: absolute;\\n  top: 0;\\n  bottom: 0;\\n  left: 0;\\n  width: 0;\\n  transition: all 0.1s linear, opacity 0.3s linear 0.2s;\\n}\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"The \", _jsx(_components.code, {\n          children: \".progress\"\n        }), \" class is the outer container which will create a fixed\\nspace at the top of the page which \", _jsx(_components.code, {\n          children: \".indicator\"\n        }), \" will fill up. The\\n\", _jsx(_components.code, {\n          children: \".indicator\"\n        }), \" has some transition effects to animate both \", _jsx(_components.code, {\n          children: \"width\"\n        }), \" and\\n\", _jsx(_components.code, {\n          children: \"opacity\"\n        }), \" so the bar fades in and out nicely and width transitions\\nalso look smooth. If we now go ahead and set the progress to something\\nother than \", _jsx(_components.code, {\n          children: \"0\"\n        }), \" initially, we should see a yellow bar at the top,\\nlet's set it to \", _jsx(_components.code, {\n          children: \"40\"\n        }), \":\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-jsx\",\n          children: \"const [progress, setProgress] = useState(40);\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Now reload the page and you should see a progress bar already at 40% progress.\\nThis is the time you'll want to do some additional styling if you don't like\\nhow it looks. Also don't forget to set the \", _jsx(_components.code, {\n          children: \"useState\"\n        }), \" default back to \", _jsx(_components.code, {\n          children: \"0\"\n        }), \"\\nwhen you're done :)\"]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"Binding the events\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"All we have to do now is to hook up to Next.js' router events\\nand make this bar move on its own whenever a navigation event occurs. To\\ndo this we'll add a \", _jsx(_components.code, {\n          children: \"useEffect\"\n        }), \" hook without any dependencies so that\\nit works like \", _jsx(_components.a, {\n          href: \"https://reactjs.org/docs/react-component.html#componentdidmount\",\n          children: _jsx(_components.code, {\n            children: \"componentDidMount\"\n          })\n        }), \"\\n/ \", _jsx(_components.a, {\n          href: \"https://reactjs.org/docs/react-component.html#componentwillunmount\",\n          children: _jsx(_components.code, {\n            children: \"componentWillUnmount\"\n          })\n        }), \"\\nlifecycle methods.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"We do this since we want\\nto make sure these listeners are only bound once, and should an unmount\\noccur we also want to make sure the old listeners are cleaned up\\nbefore any new ones are attached. This allows us to set up the listeners once,\\nand if an unmount occurs this also allows us to clean up the listeners:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-jsx\",\n          children: \"useEffect(() =\u003e {\\n    let timer;\\n\\n    function start() {\\n        setProgress(1);\\n        increment();\\n    }\\n\\n    function increment() {\\n        const timeout = Math.round(Math.random() * 300);\\n\\n        setProgress((progress) =\u003e {\\n            const percent = Math.round(Math.random() * 10);\\n            const next = Math.min(progress + percent, 80);\\n\\n            if (next \u003c 80) {\\n                timer = setTimeout(increment, timeout);\\n                return next;\\n            }\\n\\n            return 80;\\n        });\\n    }\\n\\n    function complete() {\\n        clearTimeout(timer);\\n        setProgress(100);\\n    }\\n\\n    router.events.on('routeChangeStart', start);\\n    router.events.on('routeChangeComplete', complete);\\n    router.events.on('routeChangeError', complete);\\n\\n    return () =\u003e {\\n        clearTimeout(timer);\\n        router.events.off('routeChangeStart');\\n        router.events.off('routeChangeComplete');\\n        router.events.off('routeChangeError');\\n    };\\n}, []);\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"With all the parts set up we can now go over the \", _jsx(_components.code, {\n          children: \"start\"\n        }), \", \", _jsx(_components.code, {\n          children: \"increment\"\n        }), \" and\\n\", _jsx(_components.code, {\n          children: \"complete\"\n        }), \" functions. The \", _jsx(_components.code, {\n          children: \"start\"\n        }), \" function kicks off the process on\\n\", _jsx(_components.code, {\n          children: \"routeChangeStart\"\n        }), \". It calls \", _jsx(_components.code, {\n          children: \"setProgress(1)\"\n        }), \" which makes the progress bar\\nvisible after a 0.2s delay defined in the CSS \", _jsx(_components.code, {\n          children: \"opacity\"\n        }), \" transition.\\nAfterwards, it also calls \", _jsx(_components.code, {\n          children: \"increment()\"\n        }), \" which will repeatedly call itself\\nusing \", _jsx(_components.code, {\n          children: \"setTimeout\"\n        }), \" until a certain threshold has been reached (\", _jsx(_components.code, {\n          children: \"80\"\n        }), \" in this case).\\nThis will move the progress bar at random intervals with random percentages added.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"Finally the \", _jsx(_components.code, {\n          children: \"complete\"\n        }), \" function will be called either on \", _jsx(_components.code, {\n          children: \"routeChangeComplete\"\n        }), \"\\nor \", _jsx(_components.code, {\n          children: \"routeChangeError\"\n        }), \" which will clear any remaining timeout set by \", _jsx(_components.code, {\n          children: \"increment\"\n        }), \"\\nand force the bar to \", _jsx(_components.code, {\n          children: \"100\"\n        }), \" progress causing it to fill up and fade out.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"We can safely leave \", _jsx(_components.code, {\n          children: \"progress\"\n        }), \" at \", _jsx(_components.code, {\n          children: \"100\"\n        }), \" here. There is no need to reset it\\nto \", _jsx(_components.code, {\n          children: \"0\"\n        }), \" because in our component logic we set \", _jsx(_components.code, {\n          children: \"opacity\"\n        }), \" to \", _jsx(_components.code, {\n          children: \"0\"\n        }), \" when the bar\\nis either at \", _jsx(_components.code, {\n          children: \"0\"\n        }), \" or \", _jsx(_components.code, {\n          children: \"100\"\n        }), \" progress. Additionally when new navigation events\\noccur the \", _jsx(_components.code, {\n          children: \"start\"\n        }), \" function is called which always sets it to \", _jsx(_components.code, {\n          children: \"1\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.h1, {\n        children: \"Everything together\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Finally, you'll end up with this component:\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-jsx\",\n          children: \"import {useEffect, useState} from 'react';\\nimport {useRouter} from 'next/router';\\nimport styles from './progress.module.css';\\n\\nexport default function Progress() {\\n    const router = useRouter();\\n    const [progress, setProgress] = useState(0);\\n\\n    useEffect(() =\u003e {\\n        let timer;\\n\\n        function start() {\\n            setProgress(1);\\n            increment();\\n        }\\n\\n        function increment() {\\n            const timeout = Math.round(Math.random() * 300);\\n\\n            setProgress((progress) =\u003e {\\n                const percent = Math.round(Math.random() * 10);\\n                const next = Math.min(progress + percent, 80);\\n\\n                if (next \u003c 80) {\\n                    timer = setTimeout(increment, timeout);\\n                    return next;\\n                }\\n\\n                return 80;\\n            });\\n        }\\n\\n        function complete() {\\n            clearTimeout(timer);\\n            setProgress(100);\\n        }\\n\\n        router.events.on('routeChangeStart', start);\\n        router.events.on('routeChangeComplete', complete);\\n        router.events.on('routeChangeError', complete);\\n\\n        return () =\u003e {\\n            clearTimeout(timer);\\n            router.events.off('routeChangeStart');\\n            router.events.off('routeChangeComplete');\\n            router.events.off('routeChangeError');\\n        };\\n    }, []);\\n\\n    return (\\n        \u003cdiv className={styles.progress}\u003e\\n            \u003cdiv\\n                className={styles.indicator}\\n                style={{\\n                    width: `${progress}%`,\\n                    opacity: progress \u003e 0 \u0026\u0026 progress \u003c 100 ? 1 : 0,\\n                }}\\n            /\u003e\\n        \u003c/div\u003e\\n    );\\n}\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"While it isn't as fancy as something like \", _jsx(_components.a, {\n          href: \"https://github.com/rstacruz/nprogress\",\n          children: \"NProgress\"\n        }), \",\\nwhich also shows a loading spinner, it doesn't require any library and it is\\nalso less JS and CSS. Adding an endless spinner here also wouldn't be too\\ndifficult if you really wanted to but this is something I'll leave\\nas an exercise for the reader :)\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"If you've got any questions, feel free to hit me up on Twitter \", _jsx(_components.a, {\n          href: \"https://twitter.com/scbydoooo\",\n          children: \"@scbydoooo\"\n        }), \".\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Until next time!\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"ðŸ‘‹\"\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{"title":"Building a Next.js page load progress bar","description":"I've seen a fair few tutorials on building a page load progress bar for Next.js applications but most of them use the external library NProgress. While NProgress is a very nice general purpose library we can also build our own 'cheap' progress bar without using any library!","published":"2021-04-18T19:00:00Z"}},"slug":"building-a-next-js-page-load-progress-bar"},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"building-a-next-js-page-load-progress-bar"},"buildId":"jUbFVT5Bn9Op0e0TGvL_l","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>